## Robot-Shop Project
```
→ clone repo: git clone https://github.com/instana/robot-shop.git
```
## Web 
```
FROM nginx
RUN rm -rf /usr/share/nginx/html/index.html
ADD static /usr/share/nginx/html/
```
```
→ docker build -t naveen2809/web:1.0.0 .
→ docker run -itd -p 80:80 naveen2809/web:1.0.0

http://localhost:80/
```
## Add Catalogue & Mongo
```
Web → Catalogue → Mango
Note:
Web service depends on catalogue
catalogue depends on Mongo service

Run: Web then mongoDB then Catalogue

→ docker push naveen2809/web:1.0.0

→ docker build -t naveen2809/mongodb:1.0.0 .
→ docker run -d naveen2809/mongodb:1.0.0
→ docker push naveen2809/mongodb:1.0.0

→ docker build -t naveen2809/catalogue:1.0.0 .
→ docker run -d naveen2809/catalogue:1.0.0
→ docker push naveen2809/catalogue:1.0.0
```
## Connect catalogue and mongo
```
→ catalogue needs mongo 
→ docker logs <C-ID of catalogue>
{   "level":"error",
    "time":1700803867701,"pid":1,
    "hostname":"2ac6c0f7a99e",
    "msg":"ERROR {\"name\":\"MongoNetworkError\"}","v":1
}
Error 1: we can see MongoNetworkError
```
```
In catalogue MicroService →→ server.js its reffering to mongodb

→ mongodb://mongodb:27017/catalogue
Note: It refers to name of container name →→ mongodb 
      It refers to name of db name →→ catalogue

→ it tries to establish connection with mongodb but our container name was random generated by docker
```
```
→ container name should be mongodb
Solution: docker run -d --name mongodb naveen2809/mongodb:1.0.0
→ docker run -d --name catalogue naveen2809/catalogue:1.0.0
→ docker run -d --name web -p 80:80 naveen2809/web:1.0.0
Note: provide container naming properly to establish connection between them
```
```
docker ps
CONTAINER ID   IMAGE                      COMMAND                  CREATED         STATUS         PORTS                NAMES
239d3cd50763   naveen2809/catalogue:1.0.0   "docker-entrypoint.s…"   3 minutes ago   Up 3 minutes   8080/tcp             catalogue
f84961f7f490   naveen2809/mongodb:1.0.0     "docker-entrypoint.s…"   3 minutes ago   Up 3 minutes   27017/tcp            mongodb
869cc6befb10   naveen2809/web:1.0.0         "/docker-entrypoint.…"   3 minutes ago   Up 3 minutes   0.0.0.0:80->80/tcp   web
```
```
→ docker inspect catalogue
Error 2: Even though we named properly we are unable connect because of default network (we can see MongoNetworkError)
```
```
 "Networks": {
                "bridge": {}
 }
```
```
→ we need to create network bridge for our project

Get Mongodb ip Address
→ docker inspect mongodb | grep -i ip 
o/p: 172.17.0.4

Enter into catalogue Container
→ docker exec -it catalogue bash
→ ping 172.17.0.4 // successful
→ ping mongodb // failed
Note: Every time we create container IP will change
```

## Networking
```
We need to create our own bridge network to communicate between containers because default bridge network can’t resolve on names

→ docker network ls

show network information on linux
→ ip a 

show network information on windows
→ ipconfig

Create own network
→ docker network create roboshop

Note: Now containers are isolated with other projects & communicate with names
→ docker network connect roboshop mongodb
or
→ docker run -d --name web --network roboshop -p 80:80 naveen2809/web:1.0.0
→ docker run -d --name mongodb --network roboshop naveen2809/mongodb:1.0.0
→ docker run -d --name catalogue --network roboshop naveen2809/catalogue:1.0.0
```
```
Successfully connected catalogue to Mongodb
→ docker logs catalogue
{   "level":"info",
    "time":1700805521262,
    "pid":1,"hostname":"47c3381c5877",
    "msg":"MongoDB connected","v":1
}
```
```
→ docker inspect catalogue
"Networks": {
                "roboshop": {}
}
```
### How is the Web service able to connect to the Mongodb service ??
```
→ Rename default.conf.template to default.conf
→ Copy default.conf of nginx from web paste in default.conf because it wont work 
→ default.conf we have proxy pass
location /api/catalogue/ {
        proxy_pass http://catalogue:8080/;
}

→ Communication Between Web & Catalogue
→ default.conf we have proxy 
/api/catalogue/ ⇒ call catalogue service


Edit default configurations of nginx with our requirement
→ cd /etc/nginx/nginx.conf
→ cd /etc/nginx/conf.d/default.conf
```

## User
```
Web → User → Mongo & Redis
Note:
    Web service depends on User.
    User depends on Mongo service.
    User depends on Redis.

MongoDB should run first than User
Redis should run first than User
→ docker run -itd --name redis --network roboshop redis

→ docker build -t naveen2809/user:1.0.0 .
→ docker run -itd --name user --network roboshop naveen2809/user:1.0.0

Modify default.conf for nginx to pick User Service
→ docker build -t naveen2809/web:1.0.0 .
→ docker run -d --name web --network roboshop -p 80:80 naveen2809/web:1.0.0
```

## Using docker-compose.yml we can spin up container's easily

## Cart Service
```
Web → Cart → catalogue → redis
Note:
    cart depends on catalogue & redis

redis should run first than Cart
→ docker build -t naveen2809/cart:1.0.0 .
```
## Shipping Service
```
Web → Shipping → mysql
Note:
    mysql depends on shipping

Copy Shipping & mysql.
mysql should run first than shipping.

→ docker build -t naveen2809/mysql:1.0.0 .
→ docker build -t naveen2809/shipping:1.0.0 .
```

## Payments Service
```
Web → Payment → RabbitMq
Note:
    Payments depends on RabbitMq

RabbitMq should run first than Payments
→ docker build -t naveen2809/payment:1.0.0 .
```

## Ratings Service
```
Web → Ratings → MySql
Note:
    Ratings depends on MySql

MySql should run first than Ratings
→ docker build -t naveen2809/ratings:1.0.0 .
```